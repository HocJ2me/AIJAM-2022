function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _instanceof(e,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):e instanceof n}define("discourse/plugins/discourse-presence/discourse/components/composer-presence-display",["exports","discourse-common/utils/decorators","@ember/object/computed","@ember/component","@ember/service"],(function(e,n,t,r,i){"use strict";var s,o,l,a,c,u,p,d,h,f;function m(e,n,t,r,i){var s={};return Object.keys(r).forEach((function(e){s[e]=r[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce((function(t,r){return r(e,n,t)||t}),s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,n,s),s=null),s}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var y=r.default.extend((s=(0,n.default)("model.replyingToTopic","model.editingPost","model.whisper","model.composerOpened"),o=(0,n.default)("model.topic.id","isReply","isWhisper"),l=(0,n.default)("model.topic.id","isReply","isWhisper"),a=(0,n.default)("isEdit","model.post.id"),c=(0,n.observes)("replyChannelName","whisperChannelName","editChannelName"),u=(0,n.default)("isReply","replyingUsers.[]","editingUsers.[]"),p=(0,n.on)("didInsertElement"),d=(0,n.observes)("model.reply","state","model.post.id","model.topic.id"),h=(0,n.on)("willDestroyElement"),m(f={tagName:"",presence:(0,i.inject)(),composerPresenceManager:(0,i.inject)(),state:function(e,n,t,r){if(r)return n?"edit":t?"whisper":e?"reply":void 0},isReply:(0,t.equal)("state","reply"),isEdit:(0,t.equal)("state","edit"),isWhisper:(0,t.equal)("state","whisper"),replyChannelName:function(e,n,t){if(e&&(n||t))return"/discourse-presence/reply/".concat(e)},whisperChannelName:function(e,n,t){if(e&&this.currentUser.whisperer&&(n||t))return"/discourse-presence/whisper/".concat(e)},editChannelName:function(e,n){if(e)return"/discourse-presence/edit/".concat(n)},_setupChannel:function(e,n){var t,r;(null===(t=this[e])||void 0===t?void 0:t.name)!==n&&(null===(r=this[e])||void 0===r||r.unsubscribe(),n?(this.set(e,this.presence.getChannel(n)),this[e].subscribe()):this[e]&&this.set(e,null))},_setupChannels:function(){this._setupChannel("replyChannel",this.replyChannelName),this._setupChannel("whisperChannel",this.whisperChannelName),this._setupChannel("editChannel",this.editChannelName)},_cleanupChannels:function(){this._setupChannel("replyChannel",null),this._setupChannel("whisperChannel",null),this._setupChannel("editChannel",null)},replyingUsers:(0,t.union)("replyChannel.users","whisperChannel.users"),editingUsers:(0,t.readOnly)("editChannel.users"),presenceUsers:function(e,n,t){var r,i=this,s=e?n:t;return null==s||null===(r=s.filter((function(e){return e.id!==i.currentUser.id})))||void 0===r?void 0:r.slice(0,this.siteSettings.presence_max_users_shown)},shouldDisplay:(0,t.gt)("presenceUsers.length",0),subscribe:function(){this._setupChannels()},_contentChanged:function(){var e,n;if(""!==this.model.reply){var t="edit"===this.state?null===(e=this.model)||void 0===e?void 0:e.post:null===(n=this.model)||void 0===n?void 0:n.topic;this.composerPresenceManager.notifyState(this.state,null==t?void 0:t.id)}},closeComposer:function(){this._cleanupChannels(),this.composerPresenceManager.leave()}},"state",[s],Object.getOwnPropertyDescriptor(f,"state"),f),m(f,"replyChannelName",[o],Object.getOwnPropertyDescriptor(f,"replyChannelName"),f),m(f,"whisperChannelName",[l],Object.getOwnPropertyDescriptor(f,"whisperChannelName"),f),m(f,"editChannelName",[a],Object.getOwnPropertyDescriptor(f,"editChannelName"),f),m(f,"_setupChannels",[c],Object.getOwnPropertyDescriptor(f,"_setupChannels"),f),m(f,"presenceUsers",[u],Object.getOwnPropertyDescriptor(f,"presenceUsers"),f),m(f,"subscribe",[p],Object.getOwnPropertyDescriptor(f,"subscribe"),f),m(f,"_contentChanged",[d],Object.getOwnPropertyDescriptor(f,"_contentChanged"),f),m(f,"closeComposer",[h],Object.getOwnPropertyDescriptor(f,"closeComposer"),f),f));e.default=y})),define("discourse/plugins/discourse-presence/discourse/components/topic-presence-display",["exports","discourse-common/utils/decorators","@ember/component","@ember/object/computed","@ember/service"],(function(e,n,t,r,i){"use strict";var s,o,l,a,c,u;function p(e,n,t,r,i){var s={};return Object.keys(r).forEach((function(e){s[e]=r[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce((function(t,r){return r(e,n,t)||t}),s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,n,s),s=null),s}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var d=t.default.extend((s=(0,n.default)("replyChannel.users.[]"),o=(0,n.default)("whisperChannel.users.[]"),l=(0,n.default)("topic.id"),a=(0,n.default)("topic.id"),c=(0,n.on)("willDestroyElement"),u={topic:null,presence:(0,i.inject)(),replyChannel:null,whisperChannel:null,replyUsers:function(e){var n=this;return null==e?void 0:e.filter((function(e){return e.id!==n.currentUser.id}))},whisperUsers:function(e){var n=this;return null==e?void 0:e.filter((function(e){return e.id!==n.currentUser.id}))},users:(0,r.union)("replyUsers","whisperUsers"),replyChannelName:function(e){return"/discourse-presence/reply/".concat(e)},whisperChannelName:function(e){return"/discourse-presence/whisper/".concat(e)},shouldDisplay:(0,r.gt)("users.length",0),didReceiveAttrs:function(){var e,n,t,r;(this._super.apply(this,arguments),(null===(e=this.replyChannel)||void 0===e?void 0:e.name)!==this.replyChannelName)&&(null===(t=this.replyChannel)||void 0===t||t.unsubscribe(),this.set("replyChannel",this.presence.getChannel(this.replyChannelName)),this.replyChannel.subscribe());this.currentUser.staff&&(null===(n=this.whisperChannel)||void 0===n?void 0:n.name)!==this.whisperChannelName&&(null===(r=this.whisperChannel)||void 0===r||r.unsubscribe(),this.set("whisperChannel",this.presence.getChannel(this.whisperChannelName)),this.whisperChannel.subscribe())},_destroyed:function(){var e,n;null===(e=this.replyChannel)||void 0===e||e.unsubscribe(),null===(n=this.whisperChannel)||void 0===n||n.unsubscribe()}},p(u,"replyUsers",[s],Object.getOwnPropertyDescriptor(u,"replyUsers"),u),p(u,"whisperUsers",[o],Object.getOwnPropertyDescriptor(u,"whisperUsers"),u),p(u,"replyChannelName",[l],Object.getOwnPropertyDescriptor(u,"replyChannelName"),u),p(u,"whisperChannelName",[a],Object.getOwnPropertyDescriptor(u,"whisperChannelName"),u),p(u,"_destroyed",[c],Object.getOwnPropertyDescriptor(u,"_destroyed"),u),u));e.default=d})),define("discourse/plugins/discourse-presence/discourse/services/composer-presence-manager",["exports","@ember/service","@ember/runloop","discourse-common/config/environment"],(function(e,n,t,r){"use strict";var i,s;function o(e,n,t,r){t&&Object.defineProperty(e,n,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(r):void 0})}function l(e,n){if(!_instanceof(e,n))throw new TypeError("Cannot call a class as a function")}function a(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,n){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},c(e,n)}function u(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=h(e);if(n){var i=h(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return p(this,t)}}function p(e,n){if(n&&("object"===_typeof(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var f,m,y,b,v,C,w=(i=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&c(e,n)}(f,e);var n,i,p,h=u(f);function f(){var e;l(this,f);for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return o(d(e=h.call.apply(h,[this].concat(t))),"presence",s,d(e)),e}return n=f,(i=[{key:"notifyState",value:function(e,n){if(!this.siteSettings.allow_users_to_hide_profile||!this.currentUser.hide_profile_and_presence){if(void 0===e)return this.leave();if(!["reply","whisper","edit"].includes(e))throw"Unknown intent ".concat(e);var i="".concat(e,"/").concat(n);this._state!==i&&(this._enter(e,n),this._state=i),(0,r.isTesting)()||(this._autoLeaveTimer=(0,t.debounce)(this,this.leave,1e4))}}},{key:"leave",value:function(){var e;null===(e=this._presentChannel)||void 0===e||e.leave(),this._presentChannel=null,this._state=null,this._autoLeaveTimer&&((0,t.cancel)(this._autoLeaveTimer),this._autoLeaveTimer=null)}},{key:"_enter",value:function(e,n){this.leave();var t="".concat("/discourse-presence","/").concat(e,"/").concat(n);this._presentChannel=this.presence.getChannel(t),this._presentChannel.enter()}},{key:"willDestroy",value:function(){this.leave()}}])&&a(n.prototype,i),p&&a(n,p),Object.defineProperty(n,"prototype",{writable:!1}),f}(n.default),f=i.prototype,m="presence",y=[n.inject],b={configurable:!0,enumerable:!0,writable:!0,initializer:null},C={},Object.keys(b).forEach((function(e){C[e]=b[e]})),C.enumerable=!!C.enumerable,C.configurable=!!C.configurable,("value"in C||C.initializer)&&(C.writable=!0),C=y.slice().reverse().reduce((function(e,n){return n(f,m,e)||e}),C),v&&void 0!==C.initializer&&(C.value=C.initializer?C.initializer.call(v):void 0,C.initializer=void 0),void 0===C.initializer&&(Object.defineProperty(f,m,C),C=null),s=C,i);e.default=w})),Ember.TEMPLATES["javascripts/components/composer-presence-display"]=Ember.HTMLBars.template({id:null,block:'[[[41,[30,0,["shouldDisplay"]],[[[1,"  "],[10,0],[14,0,"presence-users"],[12],[1,"\\n    "],[10,0],[14,0,"presence-avatars"],[12],[1,"\\n"],[42,[28,[37,2],[[28,[37,2],[[30,0,["presenceUsers"]]],null]],null],null,[[[1,"        "],[1,[28,[35,3],[[30,1]],[["imageSize"],["small"]]]],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n    "],[10,1],[14,0,"presence-text"],[12],[1,"\\n      "],[10,1],[14,0,"description"],[12],[1,"\\n"],[41,[30,0,["isReply"]],[[[1,[28,[35,4],["presence.replying"],[["count"],[[30,0,["presenceUsers","length"]]]]]]],[]],[[[1,[28,[35,4],["presence.editing"],[["count"],[[30,0,["presenceUsers","length"]]]]]]],[]]],[1,""],[13],[1,""],[10,1],[14,0,"wave"],[12],[1,""],[10,1],[14,0,"dot"],[12],[1,"."],[13],[10,1],[14,0,"dot"],[12],[1,"."],[13],[10,1],[14,0,"dot"],[12],[1,"."],[13],[1,""],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["user"],false,["if","each","-track-array","avatar","i18n"]]',moduleName:"javascripts/discourse/templates/components/composer-presence-display",isStrictMode:!1}),Ember.TEMPLATES["javascripts/components/topic-presence-display"]=Ember.HTMLBars.template({id:null,block:'[[[41,[30,0,["shouldDisplay"]],[[[1,"  "],[10,0],[14,0,"presence-users"],[12],[1,"\\n    "],[10,0],[14,0,"presence-avatars"],[12],[1,"\\n"],[42,[28,[37,2],[[28,[37,2],[[30,0,["users"]]],null]],null],null,[[[1,"        "],[8,[39,3],null,[["@user"],[[30,1]]],[["default"],[[[[1,"\\n          "],[1,[28,[35,4],[[30,1]],[["imageSize"],["small"]]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n    "],[10,1],[14,0,"presence-text"],[12],[1,"\\n      "],[10,1],[14,0,"description"],[12],[1,[28,[35,5],["presence.replying_to_topic"],[["count"],[[30,0,["users","length"]]]]]],[13],[10,1],[14,0,"wave"],[12],[10,1],[14,0,"dot"],[12],[1,"."],[13],[10,1],[14,0,"dot"],[12],[1,"."],[13],[10,1],[14,0,"dot"],[12],[1,"."],[13],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["user"],false,["if","each","-track-array","user-link","avatar","i18n"]]',moduleName:"javascripts/discourse/templates/components/topic-presence-display",isStrictMode:!1}),Ember.TEMPLATES["javascripts/connectors/before-composer-controls/presence"]=Ember.HTMLBars.template({id:null,block:'[[[8,[39,0],null,[["@model"],[[30,0,["model"]]]],null],[1,"\\n"]],[],false,["composer-presence-display"]]',moduleName:"javascripts/discourse/templates/connectors/before-composer-controls/presence",isStrictMode:!1}),Ember.TEMPLATES["javascripts/connectors/topic-above-footer-buttons/presence"]=Ember.HTMLBars.template({id:null,block:'[[[8,[39,0],null,[["@topic"],[[30,0,["model"]]]],null],[1,"\\n"]],[],false,["topic-presence-display"]]',moduleName:"javascripts/discourse/templates/connectors/topic-above-footer-buttons/presence",isStrictMode:!1});
//# sourceMappingURL=discourse-presence-363e51235eafe16d3cccaf18627946b221f94af77d2a9799b12d87cdd90aed9b.js.map