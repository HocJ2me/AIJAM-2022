function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}define("discourse/plugins/discourse-policy/discourse/components/policy-builder-form",["exports","@ember/component"],(function(e,t){"use strict";function o(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=a(e);if(t){var r=a(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return c(this,o)}}function c(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function p(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}(u,e);var t,c,a,s=i(u);function u(){var e;n(this,u);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return p(l(e=s.call.apply(s,[this].concat(o))),"tagName",null),p(l(e),"policy",null),p(l(e),"onChange",null),e}return t=u,c&&o(t.prototype,c),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(t.default);e.default=s})),define("discourse/plugins/discourse-policy/discourse/components/policy-form-field",["exports","@ember/component"],(function(e,t){"use strict";function o(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=a(e);if(t){var r=a(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return c(this,o)}}function c(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function p(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}(u,e);var t,c,a,s=i(u);function u(){var e;n(this,u);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return p(l(e=s.call.apply(s,[this].concat(o))),"tagName",""),e}return t=u,c&&o(t.prototype,c),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(t.default);e.default=s})),define("discourse/plugins/discourse-policy/discourse/components/policy-group-input",["exports","@ember/component","@ember/object"],(function(e,t,o){"use strict";var n,r,i;function c(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=y(e);if(t){var r=y(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return s(this,o)}}function s(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function d(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function f(e,t,o,n,r){var i={};return Object.keys(n).forEach((function(e){i[e]=n[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce((function(o,n){return n(e,t,o)||o}),i),r&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(r):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var b=(n=(0,o.computed)("groups.[]"),r=(0,o.computed)("site.groups.[]"),i=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(i,e);var t,o,n,r=p(i);function i(){var e;c(this,i);for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];return d(u(e=r.call.apply(r,[this].concat(o))),"tagName",null),d(u(e),"groups",null),d(u(e),"onChangeGroup",null),e}return t=i,(o=[{key:"selectedGroups",get:function(){return(this.groups||"").split(",").filter(Boolean)}},{key:"availableGroups",get:function(){return(this.site.groups||[]).map((function(e){if(0!==e.id)return e.name})).filter(Boolean)}},{key:"onChange",value:function(e){this.onChangeGroup&&this.onChangeGroup(e.join(","))}}])&&l(t.prototype,o),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(t.default),f(i.prototype,"selectedGroups",[n],Object.getOwnPropertyDescriptor(i.prototype,"selectedGroups"),i.prototype),f(i.prototype,"availableGroups",[r],Object.getOwnPropertyDescriptor(i.prototype,"availableGroups"),i.prototype),f(i.prototype,"onChange",[o.action],Object.getOwnPropertyDescriptor(i.prototype,"onChange"),i.prototype),i);e.default=b})),define("discourse/plugins/discourse-policy/discourse/components/policy-reminder-input",["exports","@ember/component","I18n"],(function(e,t,o){"use strict";function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=p(e);if(t){var r=p(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return l(this,o)}}function l(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return a(e)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=[{id:"daily",name:o.default.t("daily")},{id:"weekly",name:o.default.t("weekly")}],y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(y,e);var t,o,l,p=c(y);function y(){var e;r(this,y);for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];return s(a(e=p.call.apply(p,[this].concat(o))),"tagName",""),s(a(e),"reminder",null),s(a(e),"onChangeReminder",null),s(a(e),"validReminders",u),e}return t=y,o&&n(t.prototype,o),l&&n(t,l),Object.defineProperty(t,"prototype",{writable:!1}),t}(t.default);e.default=y})),define("discourse/plugins/discourse-policy/discourse/components/post-policy",["exports","@ember/component","@ember/object","discourse-common/lib/get-url","discourse-common/utils/decorators","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/show-modal","javascripts/components/post-policy"],(function(e,t,o,n,r,i,c,l,a){"use strict";var p,s,u,y,d,f,b,_,v;function m(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=w(e);if(t){var r=w(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return P(this,o)}}function P(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return j(e)}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}function k(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function S(e,t,o,n,r){var i={};return Object.keys(n).forEach((function(e){i[e]=n[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce((function(o,n){return n(e,t,o)||o}),i),r&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(r):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var E=(p=(0,o.computed)("post.policy_not_accepted_by_count","post.policy.policy_accepted_by_count"),s=(0,o.computed)("post.policy_accepted","post.policy_revoked"),u=(0,o.computed)("post.policy_accepted","post.policy_revoked"),y=(0,o.computed)("post.policy_accepted_by_count","post.policy_accepted_by.[]"),d=(0,o.computed)("post.policy_accepted_by.[]"),f=(0,o.computed)("post.policy_not_accepted_by_count","post.policy_not_accepted_by.[]"),b=(0,o.computed)("post.policy_not_accepted_by.[]"),_=(0,o.computed)("currentUser.{id,staff}","post.user_id"),v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}(s,e);var t,o,r,p=O(s);function s(){var e;m(this,s);for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];return k(j(e=p.call.apply(p,[this].concat(o))),"layout",a.default),k(j(e),"tagName",""),k(j(e),"post",null),k(j(e),"options",null),k(j(e),"showNotAccepted",!1),k(j(e),"isLoading",!1),k(j(e),"policy",null),e}return t=s,o=[{key:"didInsertElement",value:function(){var e,t,o;this._super.apply(this,arguments),null===(e=this.post)||void 0===e||e.setProperties({policy_accepted_by:(null===(t=this.post)||void 0===t?void 0:t.policy_accepted_by)||[],policy_not_accepted_by:(null===(o=this.post)||void 0===o?void 0:o.policy_not_accepted_by)||[]}),this.appEvents.on("policy:changed",this,"policyChanged")}},{key:"willDestroyElement",value:function(){this._super.apply(this,arguments),this.appEvents.off("policy:changed",this,"policyChanged")}},{key:"policyChanged",value:function(e){var t=this;if(e.message.id===this.post.id){var o=e.controller.get("model.postStream").findLoadedPost(e.message.id);if(o){var r=(0,n.default)("/posts/".concat(o.id,".json"));(0,i.ajax)(r).then((function(e){t.post.setProperties({policy_can_accept:e.policy_can_accept,policy_can_revoke:e.policy_can_revoke,policy_accepted:e.policy_accepted,policy_revoked:e.policy_revoked,policy_not_accepted_by:e.policy_not_accepted_by||[],policy_not_accepted_by_count:e.policy_not_accepted_by_count,policy_accepted_by:e.policy_accepted_by||[],policy_accepted_by_count:e.policy_accepted_by_count})}))}}}},{key:"policyHasUsers",get:function(){var e,t;return((null===(e=this.post)||void 0===e?void 0:e.policy_not_accepted_by_count)||0+(null===(t=this.post)||void 0===t?void 0:t.policy_accepted_by_count)||0)>0}},{key:"acceptButtonClasses",get:function(){var e,t,o="accept btn-accept-policy";return(null===(e=this.post)||void 0===e||!e.policy_accepted||null!==(t=this.post)&&void 0!==t&&t.policy_revoked)&&(o+=" btn-primary"),o}},{key:"revokeButtonClasses",get:function(){var e,t,o="revoke btn-revoke-policy";return(null===(e=this.post)||void 0===e||!e.policy_revoked||null!==(t=this.post)&&void 0!==t&&t.policy_accepted)&&(o+=" btn-danger"),o}},{key:"remainingAcceptedUsers",get:function(){var e,t;return((null===(e=this.post)||void 0===e?void 0:e.policy_accepted_by_count)||0)-((null===(t=this.post)||void 0===t?void 0:t.policy_accepted_by)||[]).length}},{key:"acceptedUsers",get:function(){var e;return(null===(e=this.post)||void 0===e?void 0:e.policy_accepted_by)||[]}},{key:"remainingNotAcceptedUsers",get:function(){var e,t;return((null===(e=this.post)||void 0===e?void 0:e.policy_not_accepted_by_count)||0)-((null===(t=this.post)||void 0===t?void 0:t.policy_not_accepted_by)||[]).length}},{key:"notAcceptedUsers",get:function(){return this.post.policy_not_accepted_by||[]}},{key:"canManagePolicy",get:function(){var e;return this.currentUser&&(this.currentUser.staff||this.currentUser.id===(null===(e=this.post)||void 0===e?void 0:e.user_id))}},{key:"revokePolicy",value:function(){this.post.policy_not_accepted_by.pushObject(this.currentUser),this.post.set("policy_not_accepted_by_count",this.post.policy_not_accepted_by_count+1);var e=this.post.policy_accepted_by.findBy("id",this.currentUser.id);e&&(this.post.policy_accepted_by.removeObject(e),this.post.set("policy_accepted_by_count",this.post.policy_accepted_by_count-1)),this.post.policy_can_accept!==this.post.policy_can_revoke&&this.post.setProperties({policy_can_accept:!0,policy_can_revoke:!1,policy_accepted:!1,policy_revoked:!0}),this._updatePolicy("unaccept",this.post.id)}},{key:"acceptPolicy",value:function(){this.post.policy_accepted_by.pushObject(this.currentUser),this.post.set("policy_accepted_by_count",this.post.policy_accepted_by_count+1);var e=this.post.policy_not_accepted_by.findBy("id",this.currentUser.id);e&&(this.post.policy_not_accepted_by.removeObject(e),this.post.set("policy_not_accepted_by_count",this.post.policy_not_accepted_by_count-1)),this.post.policy_can_accept!==this.post.policy_can_revoke&&this.post.setProperties({policy_can_accept:!1,policy_can_revoke:!0,policy_accepted:!0,policy_revoked:!1}),this._updatePolicy("accept",this.post.id)}},{key:"loadRemainingAcceptedUsers",value:function(){var e=this;(0,i.ajax)((0,n.default)("/policy/accepted"),{data:{post_id:this.post.id,offset:this.post.policy_accepted_by.length}}).then((function(t){t.users.forEach((function(t){e.post.policy_accepted_by.pushObject(t)}))})).catch(c.popupAjaxError)}},{key:"loadRemainingNotAcceptedUsers",value:function(){var e=this;(0,i.ajax)((0,n.default)("/policy/accepted"),{data:{post_id:this.post.id,offset:this.post.policy_not_accepted_by.length}}).then((function(t){t.users.forEach((function(t){e.post.policy_not_accepted_by.pushObject(t)}))})).catch(c.popupAjaxError)}},{key:"editPolicy",value:function(){(0,l.default)("policy-builder").setProperties({insertMode:!1,post:this.post,policy:this.policy})}},{key:"toggleShowUsers",value:function(){this.toggleProperty("showNotAccepted")}},{key:"_updatePolicy",value:function(e,t){var o=this;return this.set("isLoading",!0),(0,i.ajax)((0,n.default)("/policy/".concat(e)),{type:"put",data:{post_id:t}}).catch(c.popupAjaxError).finally((function(){return o.set("isLoading",!1)}))}}],o&&h(t.prototype,o),r&&h(t,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(t.default),S(v.prototype,"policyChanged",[r.bind],Object.getOwnPropertyDescriptor(v.prototype,"policyChanged"),v.prototype),S(v.prototype,"policyHasUsers",[p],Object.getOwnPropertyDescriptor(v.prototype,"policyHasUsers"),v.prototype),S(v.prototype,"acceptButtonClasses",[s],Object.getOwnPropertyDescriptor(v.prototype,"acceptButtonClasses"),v.prototype),S(v.prototype,"revokeButtonClasses",[u],Object.getOwnPropertyDescriptor(v.prototype,"revokeButtonClasses"),v.prototype),S(v.prototype,"remainingAcceptedUsers",[y],Object.getOwnPropertyDescriptor(v.prototype,"remainingAcceptedUsers"),v.prototype),S(v.prototype,"acceptedUsers",[d],Object.getOwnPropertyDescriptor(v.prototype,"acceptedUsers"),v.prototype),S(v.prototype,"remainingNotAcceptedUsers",[f],Object.getOwnPropertyDescriptor(v.prototype,"remainingNotAcceptedUsers"),v.prototype),S(v.prototype,"notAcceptedUsers",[b],Object.getOwnPropertyDescriptor(v.prototype,"notAcceptedUsers"),v.prototype),S(v.prototype,"canManagePolicy",[_],Object.getOwnPropertyDescriptor(v.prototype,"canManagePolicy"),v.prototype),S(v.prototype,"revokePolicy",[o.action],Object.getOwnPropertyDescriptor(v.prototype,"revokePolicy"),v.prototype),S(v.prototype,"acceptPolicy",[o.action],Object.getOwnPropertyDescriptor(v.prototype,"acceptPolicy"),v.prototype),S(v.prototype,"loadRemainingAcceptedUsers",[o.action],Object.getOwnPropertyDescriptor(v.prototype,"loadRemainingAcceptedUsers"),v.prototype),S(v.prototype,"loadRemainingNotAcceptedUsers",[o.action],Object.getOwnPropertyDescriptor(v.prototype,"loadRemainingNotAcceptedUsers"),v.prototype),S(v.prototype,"editPolicy",[o.action],Object.getOwnPropertyDescriptor(v.prototype,"editPolicy"),v.prototype),S(v.prototype,"toggleShowUsers",[o.action],Object.getOwnPropertyDescriptor(v.prototype,"toggleShowUsers"),v.prototype),v);e.default=E})),define("discourse/plugins/discourse-policy/discourse/controllers/policy-builder",["exports","@ember/utils","I18n","discourse/lib/text","discourse/mixins/modal-functionality","@ember/controller","@ember/object","discourse-common/lib/get-url","discourse/lib/ajax"],(function(e,t,o,n,r,i,c,l,a){"use strict";var p;function s(e,t,o,n,r){var i={};return Object.keys(n).forEach((function(e){i[e]=n[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce((function(o,n){return n(e,t,o)||o}),i),r&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(r):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=i.default.extend(r.default,(s(p={toolbarEvent:null,form:null,post:null,isSaving:!1,insertMode:!0,onShow:function(){this.policy||this.set("policy",c.default.create({reminder:"daily",version:1}))},onClose:function(){this.set("policy",null)},onChangeFormField:function(e,t){var o;null===(o=this.policy)||void 0===o||o.set(e,t)},insertPolicy:function(){if(this._validateForm(this.policy)){var e=this._buildParams(this.policy);this.toolbarEvent.addText("\n\n[policy ".concat(e.join(" "),"]\n[/policy]\n\n")),this.send("closeModal")}},updatePolicy:function(){var e=this;if(this._validateForm(this.policy)){this.set("isSaving",!0);var t=(0,l.default)("/posts/".concat(this.post.id));return(0,a.ajax)(t,{type:"GET",cache:!1}).then((function(t){var r=t.raw,i=e._replaceRaw(e.policy,r);if(i){var c={raw:i,edit_reason:o.default.t("discourse_policy.edit_reason")};return n.default.cookAsync(r).then((function(t){c.cooked=t.string,e.post.save(c)}))}})).finally((function(){e.set("isSaving",!1),e.send("closeModal")}))}},_buildParams:function(e){var o=[];return Object.keys(e).forEach((function(n){var r=e[n];r&&(0,t.isPresent)(r)&&o.push("".concat(n,'="').concat(r,'"'))})),o},_replaceRaw:function(e,t){var o=new RegExp("\\[policy\\s(.*?)\\]","m"),n=t.match(o);if(n&&n[1]){var r=this._buildParams(e);return t.replace(o,"[policy ".concat(r.join(" "),"]"))}return!1},_validateForm:function(e){return e.groups&&(0,t.isPresent)(e.groups)?!(!e.version||!(0,t.isPresent)(e.version))||(this.flash(o.default.t("discourse_policy.builder.errors.version"),"error"),!1):(this.flash(o.default.t("discourse_policy.builder.errors.group"),"error"),!1)}},"onChangeFormField",[c.action],Object.getOwnPropertyDescriptor(p,"onChangeFormField"),p),s(p,"insertPolicy",[c.action],Object.getOwnPropertyDescriptor(p,"insertPolicy"),p),s(p,"updatePolicy",[c.action],Object.getOwnPropertyDescriptor(p,"updatePolicy"),p),p));e.default=u})),Ember.TEMPLATES["javascripts/components/policy-builder-form"]=Ember.HTMLBars.template({id:null,block:'[[[6,[39,0],null,[["name","required"],["groups",true]],[["default"],[[[[1,"  "],[1,[28,[35,1],null,[["groups","onChangeGroup"],[[33,2,["groups"]],[28,[37,3],[[30,0],[30,0,["onChange"]],"groups"],null]]]]],[1,"\\n"]],[]]]]],[1,"\\n"],[6,[39,0],null,[["name","required"],["version",true]],[["default"],[[[[1,"  "],[1,[28,[35,4],null,[["name","type","value","input"],["version","number",[28,[37,5],[[33,2,["version"]]],null],[28,[37,3],[[30,0],[28,[37,6],[[30,0,["onChange"]],"version"],null]],[["value"],["target.value"]]]]]]],[1,"\\n"]],[]]]]],[1,"\\n"],[6,[39,0],null,[["name"],["renew"]],[["default"],[[[[1,"  "],[1,[28,[35,4],null,[["name","type","value","input"],["renew","number",[28,[37,5],[[33,2,["renew"]]],null],[28,[37,3],[[30,0],[28,[37,6],[[30,0,["onChange"]],"renew"],null]],[["value"],["target.value"]]]]]]],[1,"\\n"]],[]]]]],[1,"\\n"],[6,[39,0],null,[["name"],["renew-start"]],[["default"],[[[[1,"  "],[1,[28,[35,4],null,[["type","placeholder","name","value","input"],["date","2020-03-31","renew-start",[28,[37,5],[[28,[37,7],[[33,8],"renew-start"],null]],null],[28,[37,3],[[30,0],[28,[37,6],[[30,0,["onChange"]],"renew-start"],null]],[["value"],["target.value"]]]]]]],[1,"\\n"]],[]]]]],[1,"\\n"],[6,[39,0],null,[["name"],["reminder"]],[["default"],[[[[1,"  "],[1,[28,[35,9],null,[["reminder","onChangeReminder"],[[33,2,["reminder"]],[28,[37,3],[[30,0],[30,0,["onChange"]],"reminder"],null]]]]],[1,"\\n"]],[]]]]],[1,"\\n"],[6,[39,0],null,[["name"],["accept"]],[["default"],[[[[1,"  "],[1,[28,[35,4],null,[["type","name","value","input"],["text","accept",[28,[37,5],[[33,2,["accept"]]],null],[28,[37,3],[[30,0],[28,[37,6],[[30,0,["onChange"]],"accept"],null]],[["value"],["target.value"]]]]]]],[1,"\\n"]],[]]]]],[1,"\\n"],[6,[39,0],null,[["name"],["revoke"]],[["default"],[[[[1,"  "],[1,[28,[35,4],null,[["type","name","value","input"],["text","revoke",[28,[37,5],[[33,2,["revoke"]]],null],[28,[37,3],[[30,0],[28,[37,6],[[30,0,["onChange"]],"revoke"],null]],[["value"],["target.value"]]]]]]],[1,"\\n"]],[]]]]],[1,"\\n"],[6,[39,0],null,[["name"],["private"]],[["default"],[[[[1,"  "],[1,[28,[35,4],null,[["type","name","checked","click"],["checkbox","private",[28,[37,5],[[33,2,["private"]]],null],[28,[37,3],[[30,0],[28,[37,6],[[30,0,["onChange"]],"private"],null]],[["value"],["target.checked"]]]]]]],[1,"\\n"]],[]]]]]],[],false,["policy-form-field","policy-group-input","policy","action","input","readonly","fn","get","form","policy-reminder-input"]]',moduleName:"javascripts/discourse/templates/components/policy-builder-form",isStrictMode:!1}),Ember.TEMPLATES["javascripts/components/policy-form-field"]=Ember.HTMLBars.template({id:null,block:'[[[10,0],[15,0,[29,["policy-field ",[36,0]]]],[12],[1,"\\n  "],[10,0],[14,0,"policy-field-label"],[12],[1,"\\n    "],[10,1],[14,0,"label"],[12],[1,"\\n      "],[1,[28,[35,1],[[28,[37,2],["discourse_policy.builder.",[33,0],".label"],null]],null]],[1,"\\n"],[41,[33,4],[[[1,"        "],[10,1],[14,0,"required-field"],[12],[1,"*"],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "],[13],[1,"\\n  "],[10,0],[14,0,"policy-field-control"],[12],[1,"\\n    "],[18,1,null],[1,"\\n  "],[13],[1,"\\n  "],[10,1],[14,0,"policy-field-description"],[12],[1,"\\n    "],[10,1],[14,0,"description"],[12],[1,"\\n      "],[1,[28,[35,1],[[28,[37,2],["discourse_policy.builder.",[33,0],".description"],null]],null]],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13],[1,"\\n"]],["&default"],false,["name","i18n","concat","if","required","yield"]]',moduleName:"javascripts/discourse/templates/components/policy-form-field",isStrictMode:!1}),Ember.TEMPLATES["javascripts/components/policy-group-input"]=Ember.HTMLBars.template({id:null,block:'[[[1,[28,[35,0],null,[["content","valueProperty","nameProperty","value","onChange"],[[33,1],null,null,[33,2],[28,[37,3],[[30,0],"onChange"],null]]]]],[1,"\\n"]],[],false,["group-chooser","availableGroups","selectedGroups","action"]]',moduleName:"javascripts/discourse/templates/components/policy-group-input",isStrictMode:!1}),Ember.TEMPLATES["javascripts/components/policy-reminder-input"]=Ember.HTMLBars.template({id:null,block:'[[[1,[28,[35,0],null,[["value","content","onChange"],[[33,1],[33,2],[33,3]]]]],[1,"\\n"]],[],false,["combo-box","reminder","validReminders","onChangeReminder"]]',moduleName:"javascripts/discourse/templates/components/policy-reminder-input",isStrictMode:!1}),Ember.TEMPLATES["javascripts/components/post-policy"]=Ember.HTMLBars.template({id:null,block:'[[[41,[33,1],[[[1,"  "],[10,0],[14,0,"policy-footer"],[12],[1,"\\n    "],[10,0],[14,0,"policy-actions"],[12],[1,"\\n"],[41,[33,1,["policy_can_accept"]],[[[1,"        "],[1,[28,[35,2],null,[["isLoading","action","class","translatedLabel","icon"],[[33,3],[28,[37,4],[[30,0],"acceptPolicy"],null],[33,5],[33,6,["accept"]],[52,[33,1,["policy_accepted"]],"check"]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[33,1,["policy_can_revoke"]],[[[1,"        "],[1,[28,[35,2],null,[["isLoading","action","class","translatedLabel","icon"],[[33,3],[28,[37,4],[[30,0],"revokePolicy"],null],[33,7],[33,6,["revoke"]],[52,[33,1,["policy_revoked"]],"check"]]]]],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n    "],[10,0],[14,0,"user-lists"],[12],[1,"\\n"],[41,[51,[33,9]],[[[1,"        "],[10,1],[14,0,"no-possible-users"],[12],[1,"\\n          "],[1,[28,[35,10],["discourse_policy.no_possible_users"],null]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[33,1,["policy_accepted_by_count"]],[[[1,"        "],[11,3],[24,6,""],[24,0,"toggle toggle-accepted"],[16,"title",[28,[37,10],["discourse_policy.accepted_tooltip"],null]],[4,[38,4],[[30,0],"toggleShowUsers"],null],[12],[1,"\\n          "],[10,1],[14,0,"user-count"],[12],[1,"\\n            "],[1,[33,1,["policy_accepted_by_count"]]],[1,"\\n          "],[13],[1,"\\n          "],[1,[28,[35,11],["user-check"],null]],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[51,[33,12]],[[[41,[33,13,["length"]],[[[1,"            "],[10,0],[14,0,"users accepted"],[12],[1,"\\n"],[42,[28,[37,15],[[28,[37,15],[[33,13]],null]],null],null,[[[1,"                "],[1,[28,[35,16],[[30,1]],[["imageSize"],["tiny"]]]],[1,"\\n"]],[1]],null],[1,"\\n"],[41,[33,17],[[[1,"                "],[11,3],[24,6,""],[24,0,"load-more-users"],[4,[38,4],[[30,0],"loadRemainingAcceptedUsers"],null],[12],[1,"\\n                  +\\n                  "],[1,[34,17]],[1,"\\n                  "],[1,[28,[35,11],["user"],null]],[1,"\\n                "],[13],[1,"\\n"]],[]],null],[1,"            "],[13],[1,"\\n"]],[]],null]],[]],null]],[]],null],[1,"\\n"],[41,[33,1,["policy_not_accepted_by_count"]],[[[1,"        "],[10,0],[14,0,"seperator"],[12],[13],[1,"\\n\\n        "],[11,3],[24,6,""],[24,0,"toggle toggle-not-accepted"],[16,"title",[28,[37,10],["discourse_policy.not_accepted_tooltip"],null]],[4,[38,4],[[30,0],"toggleShowUsers"],null],[12],[1,"\\n          "],[10,1],[14,0,"user-count"],[12],[1,"\\n            "],[1,[33,1,["policy_not_accepted_by_count"]]],[1,"\\n          "],[13],[1,"\\n          "],[1,[28,[35,11],["user-times"],null]],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[33,12],[[[1,"          "],[10,0],[14,0,"users not-accepted"],[12],[1,"\\n"],[42,[28,[37,15],[[28,[37,15],[[33,18]],null]],null],null,[[[1,"              "],[1,[28,[35,16],[[30,2]],[["imageSize"],["tiny"]]]],[1,"\\n"]],[2]],null],[1,"\\n"],[41,[33,19],[[[1,"              "],[11,3],[24,6,""],[24,0,"load-more-users"],[4,[38,4],[[30,0],"loadRemainingNotAcceptedUsers"],null],[12],[1,"\\n                +\\n                "],[1,[34,19]],[1,"\\n                "],[1,[28,[35,11],["user"],null]],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"          "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"    "],[13],[1,"\\n\\n"],[41,[33,20],[[[1,"      "],[1,[28,[35,2],null,[["class","icon","action"],["no-text btn-default edit-policy-settings-btn","cog",[28,[37,4],[[30,0],"editPolicy"],null]]]]],[1,"\\n"]],[]],null],[1,"  "],[13],[1,"\\n"]],[]],null]],["acceptedUser","notAcceptedUser"],false,["if","post","d-button","isLoading","action","acceptButtonClasses","policy","revokeButtonClasses","unless","policyHasUsers","i18n","d-icon","showNotAccepted","acceptedUsers","each","-track-array","avatar","remainingAcceptedUsers","notAcceptedUsers","remainingNotAcceptedUsers","canManagePolicy"]]',moduleName:"javascripts/discourse/templates/components/post-policy",isStrictMode:!1}),Ember.TEMPLATES["javascripts/modal/policy-builder"]=Ember.HTMLBars.template({id:null,block:'[[[6,[39,0],null,[["title","class"],[[28,[37,1],["discourse_policy.builder.title"],null],"policy-builder"]],[["default"],[[[[1,"  "],[1,[28,[35,2],null,[["policy","onChange"],[[33,3],[28,[37,4],[[30,0],"onChangeFormField"],null]]]]],[1,"\\n"]],[]]]]],[1,"\\n"],[10,0],[14,0,"modal-footer"],[12],[1,"\\n"],[41,[33,6],[[[1,"    "],[1,[28,[35,7],null,[["type","class","label","action"],["button","btn-primary","discourse_policy.builder.insert",[28,[37,4],[[30,0],"insertPolicy"],null]]]]],[1,"\\n"]],[]],[[[1,"    "],[1,[28,[35,7],null,[["isLoading","type","class","label","action"],[[33,8],"button","btn-primary","discourse_policy.builder.save",[28,[37,4],[[30,0],"updatePolicy"],null]]]]],[1,"\\n"]],[]]],[13],[1,"\\n"]],[],false,["d-modal-body","concat","policy-builder-form","policy","action","if","insertMode","d-button","isSaving"]]',moduleName:"javascripts/discourse/templates/modal/policy-builder",isStrictMode:!1}),define("discourse/plugins/discourse-policy/initializers/add-policy-builder",["exports","discourse/lib/plugin-api","discourse/lib/show-modal"],(function(e,t,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={name:"add-discourse-policy-builder",initialize:function(e){e.lookup("site-settings:main").policy_enabled&&(0,t.withPluginApi)("0.8.7",(function(t){return function(e,t){var n=e.getCurrentUser(),r=t.lookup("site-settings:main");e.addToolbarPopupMenuOptionsCallback((function(){if(n)return!r.policy_restrict_to_staff_posts||n.staff?{label:"discourse_policy.builder.attach",id:"insertPolicy",group:"insertions",icon:"file-signature",action:"insertPolicy"}:void 0})),e.modifyClass("controller:composer",{pluginId:"discourse-policy",actions:{insertPolicy:function(){(0,o.default)("policy-builder").setProperties({insertMode:!0,post:null,toolbarEvent:this.toolbarEvent})}}})}(t,e)}))}};e.default=n})),define("discourse/plugins/discourse-policy/initializers/extend-for-policy",["exports","@ember/object","I18n","discourse/lib/plugin-api","discourse/lib/utilities"],(function(e,t,o,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=[{name:"groups"},{name:"version"},{name:"renew"},{name:"renew-start",camelName:"renewStart"},{name:"reminder"},{name:"accept",default:o.default.t("discourse_policy.accept_policy"),escape:!0},{name:"revoke",default:o.default.t("discourse_policy.revoke_policy"),escape:!0}];function c(e){function n(e){var o={};return i.forEach((function(t){o[t.name]=e.dataset[t.camelName||t.name]||t.default||"",t.escape&&(o[t.name]=(0,r.escapeExpression)(o[t.name]))})),(!o.version||parseInt(o.version,10)<1)&&(o.version=1),o.private="true"===e.dataset.private,t.default.create(o)}e.decorateCookedElement((function(t,r){var i=t.querySelector(".policy");if(i){if(i.innerHTML='<div class="policy-body">'.concat(i.innerHTML,"</div>"),!r){var c=document.createElement("div");return c.classList.add("policy-preview"),c.innerText=o.default.t("discourse_policy.title"),void i.prepend(c)}var l=r.getModel(),a=e.container.owner.factoryFor("component:post-policy").create({post:l,policy:n(i)});a.renderer.appendTo(a,i)}}),{onlyStream:!1,id:"discourse-policy"}),e.registerCustomPostMessageCallback("policy_change",(function(e,t){e.appEvents.trigger("policy:changed",{controller:e,message:t})}))}var l={name:"extend-for-policy",initialize:function(){(0,n.withPluginApi)("0.8.7",c)}};e.default=l})),define("discourse/plugins/discourse-policy/lib/discourse-markdown/policy",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.allowList(["div.policy"]),e.registerOptions((function(e,t){e.features.policy=!!t.policy_enabled})),e.registerPlugin((function(e){e.block.bbcode.ruler.push("policy",t)}))};var t={tag:"policy",wrap:function(e,t){return!(!t.attrs.group&&!t.attrs.groups)&&(e.attrs=[["class","policy"]],t.attrs.group&&e.attrs.push(["data-group",t.attrs.group]),t.attrs.groups&&e.attrs.push(["data-groups",t.attrs.groups]),e.attrs.push(["data-version",t.attrs.version||1]),t.attrs.renew&&e.attrs.push(["data-renew",t.attrs.renew]),t.attrs.reminder&&e.attrs.push(["data-reminder",t.attrs.reminder]),t.attrs.accept&&e.attrs.push(["data-accept",t.attrs.accept]),t.attrs.revoke&&e.attrs.push(["data-revoke",t.attrs.revoke]),t.attrs.start&&e.attrs.push(["data-renew-start",t.attrs.start]),t.attrs.private&&e.attrs.push(["data-private",t.attrs.private]),!0)}}})),define("discourse/plugins/discourse-policy/pre-initializers/define-policy-templates",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t={name:"define-policy-templates",after:"inject-discourse-objects",initialize:function(){var e="javascripts/components/post-policy";define(e,(function(){return Ember.TEMPLATES[e]}))}};e.default=t}));
//# sourceMappingURL=discourse-policy-826b6d72aae6d90564a4c1183a88a16f1d54bbb993c40344d9a52ad30e72a21d.js.map